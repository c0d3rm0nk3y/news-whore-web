<link rel="import" href="../bower_components/core-scaffold/core-scaffold.html">
<link rel="import" href="../bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="../bower_components/core-menu/core-menu.html">
<link rel="import" href="../bower_components/core-item/core-item.html">
<link rel="import" href="../bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-dropdown/paper-dropdown.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/core-list/core-list.html">
<link rel="import" href="news-search.html">
<link rel="import" href="news-card.html">
<script src="https://cdn.socket.io/socket.io-1.2.1.js"></script>


<polymer-element name="news-whore" extends="news-search" >

  <template>
    <style>
      :host {
        position: absolute;
        width: 100%;
        height: 100%;
        box-sizing: border-box;
      }

      h4 {
        padding: 5px;
      }
      paper-radio-button {
        margin: 3px;
      }
      #core_scaffold {
        position: absolute;
        top: 0px;
        right: 0px;
        bottom: 0px;
        left: 0px;
        width: 100%;
        height: 100%;
      }
      #core_header_panel {
        background-color: rgb(255, 255, 255);
      }
      #core_toolbar {
        color: rgb(255, 255, 255);
        background-color: rgb(79, 125, 201);
      }
      #core_menu {
        font-size: 16px;
      }
      #paper_input {
        left: 5px;
        top: 5px;
        position: relative;
      }
      paper_radio_group {
        left: 5px;
        top: 5px;
        position: relative;
      }
      #list {
        height: 75%;
        width: 95%;
        overflow-x: hidden;
        overflow-y: auto;
        margin: 1px;
        padding: 5px;
      }
      #content {
        height: 75%;
        overflow-y:hidden;
      }
      #prevSearches {
        height: 300px;
        width: 100%;
        overflow: auto;
      }
      #btnGo {
        left: 5px;
        top: 5px;
        position: relative;
      }
      paper-button:hover {
        background: #01DF3A;
      }

      news-card {
        height: 300px;
        width: 200px;
      }
      #row {
        height: 18px;
      }
      #searchContainer {
        margin-left: 5px;
      }
    </style>

    <core-scaffold id="core_scaffold">
      <core-header-panel mode="seamed" id="hPanel" navigation flex>

        <core-toolbar id="core_toolbar">
          <div flex>Searching...</div>
        </core-toolbar>

        <div id="searchContainer">
          <h4 id="h4">Keywords</h4>
          <paper-input label="keywords" value="sony hack 2014" id="keywords"></paper-input>
          <h4 id="h41">Sort</h4>
          <paper-radio-group selected="Newest" valueattr="label" selectedindex="0" id="sort" layout vertical>
            <paper-radio-button label="Newest" id="ascending"></paper-radio-button>
            <paper-radio-button label="Oldest" id="descending"></paper-radio-button>
          </paper-radio-group>
        </div>

        <paper-button id="btnGo" on-click="{{goClicked}}">Go</paper-button>

        <core-list id="prevSearches" data="{{searches}}" flex>
          <template>
            <span>{{model.keywords}}</span>
          </template>
        </core-list>
      </core-header-panel>

      <div id="div" main layout vertical tool>
        <core-toolbar>
          <div id="title" flex>News Whore</div>

        </core-toolbar>
      </div>
      <div id="content" flex>
        <h3>Results</h3>
        <core-list id="list"
                   grid="true"
                   width="300"
                   data="{{articles}}"
                   scrollTarget="{{$.hPannel.scroller}}"
                   flex>

          <template>

            <news-card aTitle="{{model.title}}"
                       aPublished="{{model.published}}"
                       aBody="{{model.text}}"></news-card>

          </template>

        </core-list>
      </div>
    </core-scaffold>
  </template>

  <script>

    Polymer('news-whore', {
      created: function() {},

      ready: function() {
        //this.socketIni();
      },

      onGetSearches: function() {
        this.super();
        this.$.prevSearches.updateSize();
      },
      onSearchArticles: function() {
        this.super();
        this.$.list.updateSize();
      },
      socketIni: function() {
        socket = io('http://monkey-nodejs-71725.usw1.nitrousbox.com:8080');

        socket.on('msg', function(msg) {
          console.log('msg from server:\n%s', JSON.stringify(msg));
          console.log(msg.msg);
          if(msg.msg == 'connection successful!') { this.news = []; Platform.flush(); }
          console.log(this.news);
        });

        socket.on('article', function(package) {
          console.log('%s: Article Received: %s', new Date().toLocaleTimeString(), package.title);
          this.news.push(package);
          this.news.push('title: "monkeys a coming"');
          console.log('%s: Article Count: %s', new Date().toLocaleTimeString(), this.news.length);
        });
      },

      domReady: function() {},

      goClicked: function() {
        try {
          console.log('%s: goClicked()..', new Date().toTimeString());
          this.reset();
          this.searchNews(this.$.keywords.value);
          //socket.emit('searchNews', {keywords: this.$.keywords.value});
        }
        catch(e) { console.log('goClicked() e: %s', e); }
      },

      attributeChanged: function(attrName, oldVal, newVal) {
        //var newVal = this.getAttribute(attrName);
        console.log(attrName, 'old: ' + oldVal, 'new:', newVal);
      }
    });

  </script>

</polymer-element>