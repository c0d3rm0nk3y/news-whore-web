<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">


<polymer-element name="news-service" attributes="news keywords scoring num when">

  <template>
    <style>
      :host {
        position: absolute;
        width: 100%;
        height: 100%;
        box-sizing: border-box;
      }
    </style>

    <core-ajax
               id="ajax"
               withCredentials="true"
               headers='{"Access-Control-Allow-Credentials": "true"}'
               url="http://datawhore:monkeyFun1!@monkey-nodejs-71725.usw1.nitrousbox.com:8080/api/searchNews?keywords=sony+hacked+2014"
               on-core-response="{{newsLoaded}}"
               handleAs="json">
    </core-ajax>

  </template>

  <script>

    Polymer(
      'news-service', {
        baseUrl: "monkey-nodejs-71725.usw1.nitrousbox.com:8080/api/searchNews?",
        username: "datawhore",
        password: "monkeyFun!",

        created: function() {
          this.news = [];
        },
        newsLoaded: function() {
          this.news = this.$.ajax.response.slice(0);
          console.log("Count: %s", Object.keys(this.news).length);
          console.log(this.news[0]);
        },
        toggleRead: function(index) {
          // this.news[index] = !this.posts[index].isRead;
          // in reality a API call is made toggling the post..
        },
        fetch: function(keywords, scoring, num, when) {
          console.log('\nnews-service.fetch(): called..');
          console.log('\nkeywords: %s\nscoring: %s\nnum: %s\nwhen: %s', keywords, scoring, num, when);
          while(keywords.indexOf(' ') > -1 )
            keywords = keywords.replace(' ', '+');
          var uri = "http://" + this.username + ":" + this.password + "@" +
                     this.baseUrl + "keywords=" + keywords + "&num=" + num;


          console.log(uri);
          this.$.ajax.url = uri;
          this.$.ajax.go();
        }

      }
    );

  </script>

</polymer-element>